let single={javascript:["// ",""],python:["# ",""],java:["// ",""],c:["// ",""],cpp:["// ",""],csharp:["// ",""],php:["// ",""],ruby:["# ",""],json:["// ",""],xml:["<!-- "," -->"],css:["/* "," */"],arduino:["// ",""],vbnet:["' ",""],swift:["// ",""],kotlin:["// ",""],go:["// ",""],rust:["// ",""],scala:["// ",""],haskell:["-- ",""],bash:["// ",""],shell:["// ",""],powershell:["// ",""],ocaml:["(* "," *)"],haxe:["// ",""],lua:["-- ",""],typescript:["// ",""],perl:["# ",""],groovy:["// ",""],julia:["// ",""],coffeescript:["// ",""],fsharp:["// ",""],pascal:["// ",""],prolog:["% ",""],lisp:["; ",""],erlang:["% ",""],elixir:["// ",""],elm:["// ",""],apl:["! ",""],scheme:["; ",""],matlab:["% ",""],verilog:["// ",""],dart:["// ",""]},multi={javascript:["/* "," */"],python:['""" ',' """'],java:["/* "," */"],c:["/* "," */"],cpp:["/* "," */"],csharp:["/* "," */"],php:["/* "," */"],json:["/* "," */"],xml:["<!-- "," -->"],css:["/* "," */"],arduino:["/* "," */"],swift:["/* "," */"],kotlin:["/* "," */"],go:["/* "," */"],rust:["/* "," */"],scala:["/* "," */"],haskell:["{- "," -}"],ocaml:["(* "," *)"],lua:["--[[ "," --]]"],typescript:["/* "," */"],perl:["\n=begin","\n=end"],coffeescript:["/* "," */"]};function getScrollBarWidth(){var e=document.createElement("p");e.style.width="100%",e.style.height="200px";var t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t);var l=e.offsetWidth;t.style.overflow="scroll";var n=e.offsetWidth;return l==n&&(n=t.clientWidth),document.body.removeChild(t),l-n}function convertPercentageToPixelsw(e,t){var l;return t/100*e.parentElement.clientWidth}function convertPercentageToPixels(e,t){var l;return t/100*e.parentElement.clientHeight}export function coderInit(e){document.addEventListener("DOMContentLoaded",()=>{let t=document.getElementsByTagName("coder");for(let l=0;l<t.length;l++){let n=t[l];n.classList.add("coder-editor"),null!=n.getAttribute("lines")?"nostyle"==n.getAttribute("lines").toLocaleLowerCase()?(n.innerHTML=`<div class="coder-lines hljs"></div><textarea name="codeEditor" class="coder-tea" spellcheck="false" wrap="hard">${n.innerHTML}</textarea><div class="coder-display hljs">`,console.log("ee")):n.innerHTML=`<div class="coder-lines hljs hljs-comment"></div><textarea name="codeEditor" class="coder-tea" spellcheck="false" wrap="hard">${n.innerHTML}</textarea><div class="coder-display hljs">`:n.innerHTML=`<textarea name="codeEditor" class="coder-tea" spellcheck="false" wrap="hard">${n.innerHTML}</textarea><div class="coder-display hljs">`,n.outerHTML=n.outerHTML.replace("coder","div")}t=document.getElementsByClassName("coder-editor");for(let i=0;i<t.length;i++){let a=t[i],s=a.getElementsByClassName("coder-tea")[0],r=a.getElementsByClassName("coder-display")[0],o=a.getElementsByClassName("coder-lines")[0],c=a.getAttribute("lang"),g=[],h=[],d=()=>{let e=s.value,t=s.selectionStart,l=s.selectionEnd;g.push({value:e,selectionStart:t,selectionEnd:l}),h=[]},p=e=>{if(g.length>0){h.push(g.pop());let t=g[g.length-1]||{value:"",selectionStart:0,selectionEnd:0};e.value=t.value,e.selectionStart=t.selectionStart,e.selectionEnd=t.selectionEnd,S()}},f=e=>{if(h.length>0){let t=h.pop();g.push(t),e.value=t.value,e.selectionStart=t.selectionStart,e.selectionEnd=t.selectionEnd,S()}},u=" ".repeat(Number(a.getAttribute("tab-length")?a.getAttribute("tab-length"):4)),S=()=>{let t=e.highlight(s.value,{language:c}).value.replaceAll("\n","<br>").split("<br>"),l="";for(let n=0;n<t.length;n++){let i=t[n],a=i.replace(i.trimStart(),"");t[n]=a.replaceAll(u,'<span class="hljs-tab">'+u+"</span>")+i.trimStart()}if(r.innerHTML=t.join("<br>"),o){for(let g=0;g<t.length;g++)l+=(g+1).toString()+"<br>";o.innerHTML=l}};S(),s.addEventListener("input",()=>{d(),S()}),r.style.fontWeight=window.getComputedStyle(s).fontWeight,r.style.fontSize=window.getComputedStyle(s).fontSize,r.style.height=(convertPercentageToPixels(r,100)-getScrollBarWidth()).toString()+"px",r.style.width=(convertPercentageToPixelsw(r,100)-getScrollBarWidth()).toString()+"px";let y;o&&(o.style.fontWeight=window.getComputedStyle(s).fontWeight,o.style.fontSize=window.getComputedStyle(s).fontSize,o.style.height=(convertPercentageToPixels(o,100)-getScrollBarWidth()).toString()+"px",s.style.marginLeft=(Number(s.style.marginLeft.slice(0,-2))+Number(window.getComputedStyle(o).width.slice(0,-2))).toString()+"px",r.style.marginLeft=(Number(r.style.marginLeft.slice(0,-2))+Number(window.getComputedStyle(o).width.slice(0,-2))).toString()+"px",y=Number(window.getComputedStyle(o).width.slice(0,-2))),window.addEventListener("resize",()=>{r.style.fontWeight=window.getComputedStyle(s).fontWeight,r.style.fontSize=window.getComputedStyle(s).fontSize,r.style.height=(convertPercentageToPixels(r,100)-getScrollBarWidth()).toString()+"px",r.style.width=(convertPercentageToPixelsw(r,100)-getScrollBarWidth()).toString()+"px",o&&(o.style.fontWeight=window.getComputedStyle(s).fontWeight,o.style.fontSize=window.getComputedStyle(s).fontSize,o.style.height=(convertPercentageToPixels(o,100)-getScrollBarWidth()).toString()+"px",s.style.marginLeft=(Number(s.style.marginLeft.slice(0,-2))-y+Number(window.getComputedStyle(o).width.slice(0,-2))).toString()+"px",r.style.marginLeft=(Number(r.style.marginLeft.slice(0,-2))-y+Number(window.getComputedStyle(o).width.slice(0,-2))).toString()+"px",y=Number(window.getComputedStyle(o).width.slice(0,-2)))}),s.addEventListener("scroll",()=>{r.scrollTop=s.scrollTop,r.scrollLeft=s.scrollLeft,o&&(o.scrollTop=s.scrollTop,o.scrollLeft=s.scrollLeft)}),document.addEventListener("keydown",function(e){let t=s,l=t.selectionStart,n=t.selectionEnd,i=t.value.substring(0,l),a=t.value.substring(n),r=t.value.substring(l,n);if("Tab"===e.key){e.preventDefault();let o=i+u+a;t.value=o,t.setSelectionRange(l+u.length,l+u.length),d(),S()}if("("===e.key){e.preventDefault();let g=i+"("+r+")"+a;t.value=g,t.setSelectionRange(l+1,n+1),d(),S()}if("["===e.key){e.preventDefault();let h=i+"["+r+"]"+a;t.value=h,t.setSelectionRange(l+1,n+1),d(),S()}if("{"===e.key){e.preventDefault();let y=i+"{"+r+"}"+a;t.value=y,t.setSelectionRange(l+1,n+1),d(),S()}if('"'===e.key){e.preventDefault();let v=i+'"'+r+'"'+a;t.value=v,t.setSelectionRange(l+1,n+1),d(),S()}if("'"===e.key){e.preventDefault();let $=i+"'"+r+"'"+a;t.value=$,t.setSelectionRange(l+1,n+1),d(),S()}if("`"===e.key){e.preventDefault();let m=i+"`"+r+"`"+a;t.value=m,t.setSelectionRange(l+1,n+1),d(),S()}if(">"===e.key&&"xml"==c.toLocaleLowerCase()){e.preventDefault();let _=i.match(/<(\w+)[^>]*>?$/);if(_){let L=i+"></"+_[1]+">"+a;t.value=L,d(),S(),t.setSelectionRange(l+1,n+1)}else{let E=i+">"+a;t.value=E,t.setSelectionRange(l+1,l+1),d(),S()}}if("Backspace"===e.key){if((i.endsWith('"')&&a.startsWith('"')||i.endsWith("'")&&a.startsWith("'")||i.endsWith("`")&&a.startsWith("`")||i.endsWith("(")&&a.startsWith(")")||i.endsWith("[")&&a.startsWith("]")||i.endsWith("{")&&a.startsWith("}"))&&t.selectionStart===t.selectionEnd){e.preventDefault();let w=i.slice(0,-1)+a.slice(1),x=t.selectionStart,k=t.selectionEnd;t.value=w,t.selectionStart=x-1,t.selectionEnd=k-1,d(),S()}if(""===i.split("\n").slice(-1)[0].trimStart()&&i.split("\n").slice(-1)[0].length>=u.length){e.preventDefault();let b=i.slice(0,-1*u.length)+a,W=t.selectionStart,C=t.selectionEnd;t.value=b,t.selectionStart=W-u.length,t.selectionEnd=C-u.length,d(),S()}}if(e.ctrlKey&&"z"===e.key&&(e.preventDefault(),p(t),S()),e.ctrlKey&&"y"===e.key&&(e.preventDefault(),f(t),S()),e.altKey&&"c"===e.key&&single[c.toLocaleLowerCase()]){e.preventDefault();let T=single[c.toLocaleLowerCase()][0],D=single[c.toLocaleLowerCase()][1];if(t.selectionStart===t.selectionEnd){let j=t.value.split("\n"),P=0,B=0;for(let R=0;R<j.length;R++)if((B+=j[R].length+1)>=t.selectionStart){P=R;break}i=t.value.split(j[P])[0],a=t.value.split(j[P])[1],r=j[P]}let A=r.split("\n"),H=A.length;if(A.length>1){for(let K=0;K<A.length;K++)A[K]=T+A[K]+D;A=A.join("\n")}else A=T+A.join("\n")+D;let M=i+A+a;t.value=M,1===H?t.setSelectionRange(l+T.length,n+T.length):t.setSelectionRange(l,l),d(),S()}if("a"===e.key&&e.altKey&&multi[c.toLocaleLowerCase()]){let z=multi[c.toLocaleLowerCase()][0],N=i+z+r+multi[c.toLocaleLowerCase()][1]+a;t.value=N,t.setSelectionRange(l+z.length,n+z.length),d(),S()}if(e.ctrlKey&&"c"===e.key&&t.selectionStart===t.selectionEnd){e.preventDefault();let U=t.value.split("\n"),I=0,O=0;for(let q=0;q<U.length;q++)if((O+=U[q].length+1)>=t.selectionStart){I=q;break}d(),navigator.clipboard.writeText("\n"+U[I]),S()}if(e.shiftKey&&e.altKey&&t.selectionStart===t.selectionEnd){if("ArrowDown"==e.key){e.preventDefault();let F=t.value.split("\n"),G=0,J=0;for(let Q=0;Q<F.length;Q++)if((J+=F[Q].length+1)>=t.selectionStart){G=Q;break}let V=F[G];F[G]+="\n"+F[G];let X=t.selectionStart;t.value=F.join("\n"),t.selectionStart=X+V.length+1,t.selectionEnd=t.selectionStart,d(),S()}return}if(e.shiftKey&&e.altKey&&t.selectionStart===t.selectionEnd){if("ArrowUp"==e.key){e.preventDefault();let Y=t.value.split("\n"),Z=0,ee=0;for(let et=0;et<Y.length;et++)if((ee+=Y[et].length+1)>=t.selectionStart){Z=et;break}Y[Z]+="\n"+Y[Z];let el=t.selectionStart;t.value=Y.join("\n"),t.selectionStart=el,t.selectionEnd=t.selectionStart,d(),S()}return}if(e.altKey&&t.selectionStart===t.selectionEnd&&"ArrowUp"==e.key){e.preventDefault();let en=t.value.split("\n"),ei=0,ea=0;for(let es=0;es<en.length;es++)if((ea+=en[es].length+1)>=t.selectionStart){ei=es;break}let er=en[ei-1],eo=en[ei];en[ei]=er,en[ei-1]=eo;let ec=t.selectionStart;t.value=en.join("\n"),t.selectionStart=ec-er.length-1,t.selectionEnd=t.selectionStart,d(),S()}if(e.altKey&&t.selectionStart===t.selectionEnd&&"ArrowDown"==e.key){e.preventDefault();let eg=t.value.split("\n"),eh=0,ed=0;for(let ep=0;ep<eg.length;ep++)if((ed+=eg[ep].length+1)>=t.selectionStart){eh=ep;break}let ef=eg[eh+1],eu=eg[eh];eg[eh]=ef,eg[eh+1]=eu;let eS=t.selectionStart;t.value=eg.join("\n"),t.selectionStart=eS+ef.length+1,t.selectionEnd=t.selectionStart,d(),S()}if("Enter"==e.key){let ey=t.value.split("\n"),ev=0,e$=0;for(let em=0;em<ey.length;em++)if((e$+=ey[em].length+1)>=t.selectionStart){ev=em;break}if(ey[ev].trimStart()!==ey[ev]){e.preventDefault();let e_=t.selectionStart,eL=("\n"+ey[ev].replace(ey[ev].trimStart(),"")).length;ey[ev]+="\n"+ey[ev].replace(ey[ev].trimStart(),"");let eE=i+"\n"+ey[ev].replace(ey[ev].trimStart(),"")+r+a;t.value=eE,t.selectionStart=e_+eL,t.selectionEnd=t.selectionStart,d(),S()}}})}})}